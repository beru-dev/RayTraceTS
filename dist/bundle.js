(()=>{"use strict";const t=require("fs");var n=function(t,n,r){return[t,n,r,1]},r=function(t,n){return[t[0]-n[0],t[1]-n[1],t[2]-n[2],t[3]-n[3]]},i=function(t){return[-t[0],-t[1],-t[2],-t[3]]},o=function(t,n){return[t[0]*n,t[1]*n,t[2]*n,t[3]*n]},e=function(t){var n=function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}(t);return[t[0]/n,t[1]/n,t[2]/n,t[3]/n]},s=function(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]+t[3]*n[3]},u=function(t,n){this.t=t,this.object=n},c=function(){function t(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.list=t}return t.prototype.hit=function(){var t;return this.list.forEach((function(n){(!t&&n.t>=0||Boolean(t)&&n.t>=0&&n.t<t.t)&&(t=n)})),t||null},t}(),h=function(){function t(t,n,r){r.length===t*n?(this.matrix=r,this.rows=t,this.columns=n):this.error="New Matrix constructor error. The input matrix should be "+t*n+" elements long, but is actually "+r.length+" elements long."}return t.prototype.index=function(t,n,r){if(t*n<=this.matrix.length-1)return void 0!==r?this.matrix[t*this.columns+n]=r:this.matrix[t*this.columns+n]},t.prototype.transpose=function(){for(var n=[],r=0;r<this.columns;r++)for(var i=0;i<this.rows;i++)n.push(this.index(i,r));return new t(this.columns,this.rows,n)},t.prototype.toString=function(){var t=this,n="";return this.matrix.forEach((function(r,i){var o=" ",e=i%t.columns==0;0!==i&&e&&(o=" / "),n+=""+o+r})),"["+n+" ]"},t}(),a=new h(4,4,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),f=function(t,n){if(16===t.matrix.length){for(var r=[],i=0;i<4;i++){for(var o=0,e=0;e<4;e++)o+=t.index(i,e)*n[e];r.push(o)}return[r[0],r[1],r[2],r[3]]}return null},l=function(t,n,r){return v(function(t,n,r){for(var i=[],o=0;o<t.rows;o++)for(var e=0;e<t.columns;e++)o!==n&&e!==r&&i.push(t.index(o,e));return new h(t.rows-1,t.columns-1,i)}(t,n,r))},p=function(t,n,r){return(n+r)%2==0?l(t,n,r):-l(t,n,r)},v=function(t){var n=t.rows,r=t.columns,i=t.matrix;if(2===n&&2===r)return i[0]*i[3]-i[1]*i[2];for(var o=0,e=0;e<r;e++)o+=t.index(0,e)*p(t,0,e);return o},m=function(t){var n=Array.from(Array(t.rows*t.columns)),r=new h(t.rows,t.columns,n),i=v(t);if(0!==i){for(var o=0;o<t.rows;o++)for(var e=0;e<t.columns;e++){var s=p(t,o,e);r.index(e,o,s/i)}return r}return console.log(t.toString+" is not invertible!!!!111!!!1!!!!"),t};const d=function(){function t(t,n){this.origin=t,this.direction=n}return t.prototype.position=function(t){return n=this.origin,r=o(this.direction,t),[n[0]+r[0],n[1]+r[1],n[2]+r[2],n[3]+r[3]];var n,r},t.prototype.intersect=function(t){var i=this.transform(m(t.transform)),o=r(i.origin,n(0,0,0)),e=s(i.direction,i.direction),h=2*s(i.direction,o),a=h*h-4*e*(s(o,o)-1);return a<0?new c:new c(new u((-h-Math.sqrt(a))/(2*e),t),new u((-h+Math.sqrt(a))/(2*e),t))},t.prototype.transform=function(n){return new t(f(n,this.origin),f(n,this.direction))},t}();var w=function(t,n,r){return[t,n,r]},x=function(t,n){return[t[0]+n[0],t[1]+n[1],t[2]+n[2]]},g=function(t,n){return[t[0]*n,t[1]*n,t[2]*n]},y=function(t){return t>1?t=1:t<0&&(t=0),Math.round(255*t)};const P=function(){function t(t,n,r,i,o){void 0===t&&(t=[1,1,1]),void 0===n&&(n=.1),void 0===r&&(r=.9),void 0===i&&(i=.9),void 0===o&&(o=200),this.color=t,this.ambient=n,this.diffuse=r,this.specular=i,this.shininess=o}return t.prototype.lighting=function(t,n,u,c){var h,a,f,l,p,v,m=(h=this.color,a=t.intensity,[h[0]*a[0],h[1]*a[1],h[2]*a[2]]),d=g(m,this.ambient),y=e(r(t.position,n)),P=s(y,c);if(P<0)f=w(0,0,0),l=w(0,0,0);else{f=g(m,this.diffuse*P);var b=(p=i(y),r(p,o(v=c,2*s(p,v)))),M=s(b,u);if(M<=0)l=w(0,0,0);else{var T=Math.pow(M,this.shininess);l=g(t.intensity,this.specular*T)}}return x(d,x(f,l))},t}(),b=function(){function t(t){this.id=t,this.transform=a,this.material=new P}return t.prototype.setTransform=function(t){this.transform=function(t,n){if(t.columns===n.rows){for(var r=[],i=0;i<t.rows;i++)for(var o=0;o<n.columns;o++){for(var e=0,s=0;s<t.columns;s++)e+=t.index(i,s)*n.index(s,o);r.push(e)}return new h(t.rows,n.columns,r)}return null}(this.transform,t)},t.prototype.normalAt=function(t){var i=f(m(this.transform),t),o=r(i,n(0,0,0)),s=f(m(this.transform).transpose(),o);return s[3]=0,e(s)},t}(),M=function(){function t(t,n){this.width=t,this.height=n,this.pixels=[];for(var r=0;r<t*n;r++)this.pixels.push(w(0,0,0))}return t.prototype.coordsToIndex=function(t,n){t=Math.round(t);var r=(n=Math.round(n))*this.width+t;return r>=0&&r+1<=this.pixels.length?r:void 0},t.prototype.pixelAt=function(t,n){return this.pixels[this.coordsToIndex(t,n)]},t.prototype.writePixel=function(t,n,r){var i=this.coordsToIndex(t,n);i>=0&&(this.pixels[i]=r)},t.prototype.canvasToPpm=function(){return"P3\n"+this.width+" "+this.height+"\n255\n"+this.getPixelData()},t.prototype.getPixelData=function(){for(var t="",n=0;n<this.height;n++)t+=this.getPixelRowData(n*this.width,(n+1)*this.width);return t},t.prototype.getPixelRowData=function(t,n){var r=this.pixels.slice(t,n),i="",o=-1;return r.forEach((function(t){(function(t){return[y(t[0]),y(t[1]),y(t[2])]})(t).forEach((function(t){var n=" ",r=t.toString().length;o<=0&&(n=""),o+r+1>70&&(n="\n",o=-1),i+=""+n+t,o+=r+1}))})),i+"\n"},t}(),T=function(t,n){this.intensity=n,this.position=t};!function(){var o=n(0,0,-5),s=new M(200,200),u=new b("1");u.material=new P([1,.2,1]);for(var c=new T(n(-10,10,-10),w(1,1,1)),h=0;h<199;h++)for(var a=3.5-.035*h,f=0;f<199;f++){var l=n(a,3.5-.035*f,10),p=new d(o,e(r(l,o))),v=p.intersect(u).hit();if(v){var m=i(p.direction),x=p.position(v.t),g=v.object.normalAt(x),y=v.object.material.lighting(c,x,m,g);s.writePixel(h,f,y)}}var A=s.canvasToPpm();(0,t.writeFile)("eye_candy/purpleSphere_200x200.ppm",A,(function(t){if(t)return console.log(t)}))}()})();